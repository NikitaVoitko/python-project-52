{% extends 'base.html' %}

{% block content %}
    <h2>Task List</h2>
    
    <form method="get" action="{% url 'task-list' %}">
        <div>
            <label for="status">Filter by Status:</label>
            <select name="status" id="status">
                <option value="">All</option>
                {% for status in statuses %}
                    <option value="{{ status.id }}" {% if status.id|stringformat:"s" == request.GET.status %}selected{% endif %}>
                        {{ status.name }}
                    </option>
                {% endfor %}
            </select>
        </div>
        <div>
            <label for="author">Filter by Author:</label>
            <select name="author" id="author">
                <option value="">All</option>
                {% for user in users %}
                    <option value="{{ user.id }}" {% if user.id|stringformat:"s" == request.GET.author %}selected{% endif %}>
                        {{ user.username }}
                    </option>
                {% endfor %}
            </select>
        </div>
        <div>
            <label for="labels">Filter by Label:</label>
            <select name="labels" id="labels">
                <option value="">All</option>
                {% for label in labels %}
                    <option value="{{ label.id }}" {% if label.id|stringformat:"s" == request.GET.labels %}selected{% endif %}>
                        {{ label.name }}
                    </option>
                {% endfor %}
            </select>
        </div>
        <button type="submit">Filter</button>
    </form>

    <ul>
        {% for task in tasks %}
            <li>
                <a href="{% url 'task-detail' task.pk %}">{{ task.name }}</a> - {{ task.status.name }} - {{ task.author.username }}
                {% if task.labels.all %}
                    <p>Labels: 
                        {% for label in task.labels.all %}
                            {{ label.name }}{% if not forloop.last %}, {% endif %}
                        {% endfor %}
                    </p>
                {% endif %}
            </li>
        {% endfor %}
    </ul>

    <a href="{% url 'task-create' %}" class="btn btn-primary">Create New Task</a>
{% endblock %}